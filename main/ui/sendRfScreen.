//
// Created by salman on 12/12/24.
//

#include "lvgl.h"
#include <stdio.h>
#include <string.h>
#include "cJSON/cJSON.h"
/*
void addDataDropDown(lv_obj_t *obj) {
    FILE *file = fopen("devices.json", "r");
    if (!file) {
        printf("No se pudo abrir el archivo devices.json\n");
        return;
    }

    fseek(file, 0, SEEK_END);
    long file_size = ftell(file);
    fseek(file, 0, SEEK_SET);

    char *data = malloc(file_size + 1);
    fread(data, 1, file_size, file);
    data[file_size] = '\0';

    cJSON *root = cJSON_Parse(data);
    free(data);
    fclose(file);

    if (!root || !cJSON_IsArray(root)) {
        printf("El archivo JSON no tiene un formato válido.\n");
        cJSON_Delete(root);
        return;
    }

    // Añadir opciones al dropdown con IDs únicos como prefijos
    cJSON *device = NULL;
    cJSON_ArrayForEach(device, root) {
        cJSON *id = cJSON_GetObjectItem(device, "id");
        cJSON *name = cJSON_GetObjectItem(device, "name");

        if (cJSON_IsNumber(id) && cJSON_IsString(name)) {
            char option_text[64];
            snprintf(option_text, sizeof(option_text), "%d: %s", id->valueint, name->valuestring);
            lv_dropdown_add_option(obj, option_text, 0);
        }
    }

    cJSON_Delete(root);

    // Manejar cambio de selección en el dropdown
    //lv_obj_add_event_cb(obj, selectinterface, LV_EVENT_VALUE_CHANGED, NULL);
}
*/

void sendRF() {
    sendRFScreen = lv_obj_create(NULL);

    // Título
    lv_obj_t *labelTitle = lv_label_create(sendRFScreen);
    lv_label_set_text(labelTitle, "Seleccione un dispositivo:");
    lv_obj_set_style_text_color(labelTitle, lv_color_hex(0x4A4A4A), 0);
    lv_obj_align(labelTitle, LV_ALIGN_TOP_MID, 0, 20);

    // Crear dropdown para seleccionar dispositivo
    lv_obj_t *dd_devices = lv_dropdown_create(sendRFScreen);
    lv_obj_set_width(dd_devices, 140);
    lv_obj_align(dd_devices, LV_ALIGN_CENTER, 0, -70);
    lv_dropdown_clear_options(dd_devices);

    //addDataDropDown(dd_devices);

    lv_obj_t *rtrnbtn = lv_btn_create(sendRFScreen);
    lv_obj_set_width(rtrnbtn, 20);
    lv_obj_set_height(rtrnbtn, 20);
    lv_obj_align(rtrnbtn, LV_ALIGN_TOP_LEFT, 10, 10);
    lv_obj_t *btnIRlb = lv_label_create(rtrnbtn);
    lv_obj_align(btnIRlb, LV_ALIGN_CENTER, 0, 0);
    lv_label_set_text(btnIRlb, "<");
}
